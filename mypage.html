<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CARPOOOO - 마이페이지</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
</head>

<body>
    <div class="header">
        <h4 class="fw-bold">마이페이지</h4>
        <p id="welcomeMsg" class="mb-0"></p>
        <button id="logoutBtn" class="btn btn-sm btn-outline-light mt-2">로그아웃</button>
    </div>

    <div class="container mt-4">
        <!-- 리워드 -->
        <div class="card p-3 mb-3 text-center">
            <h6 class="fw-bold">리워드 & 충전금</h6>
            <p class="mb-1">보유 포인트: <span id="userPoints" class="fw-bold text-primary">0P</span></p>
            <button class="btn btn-sm btn-primary" onclick="chargePoints()">충전하기</button>
        </div>

        <!-- 내 차 -->
        <div class="card p-3 mb-3">
            <h6 class="fw-bold"><i class="bi bi-car-front-fill me-1"></i> 내 차</h6>
            <div id="myCar">등록된 차량 없음</div>
        </div>

        <!-- 이용권 -->
        <div class="card p-3 mb-3">
            <h6 class="fw-bold"><i class="bi bi-ticket-perforated-fill me-1"></i> 이용권</h6>
            <p id="myTickets">보유 이용권 없음</p>
        </div>

        <!-- 이용 내역 -->
        <div class="card p-3 mb-3">
            <h6 class="fw-bold"><i class="bi bi-clock-history me-1"></i>최근이용내역</h6>
            <ul id="myHistory" class="list-group list-group-flush">
                <li class="list-group-item">내역 없음</li>
            </ul>
        </div>
    </div>

    <div class="footer">
        <p>© 2025 CARPOOOO. All rights reserved.</p>
    </div>

    <div class="tabbar">
        <div onclick="location.href='search.html'"><i class="bi bi-search"></i>검색</div>
        <div onclick="location.href='booking.html'"><i class="bi bi-calendar-check"></i>예약</div>
        <div onclick="location.href='index.html'"><i class="bi bi-house-door-fill"></i>홈</div>
        <div onclick="location.href='wishlist.html'"><i class="bi bi-heart-fill"></i>찜</div>
        <div class="active" onclick="location.href='mypage.html'"><i class="bi bi-person-circle"></i>마이</div>
    </div>

    <script>
        const currentUser = JSON.parse(localStorage.getItem("currentUser"));
        if (!currentUser) {
            alert("로그인 후 이용 가능합니다.");
            window.location.href = "login.html";
        } else {
            // 환영 메시지 & 포인트 표시
            document.getElementById("welcomeMsg").innerText = `${currentUser.name}님 환영합니다 👋`;
            document.getElementById("userPoints").innerText = (currentUser.points || 0).toLocaleString() + "P";

            // 🚗 내 차 표시
            const myCarDiv = document.getElementById("myCar");
            if (currentUser.cars && currentUser.cars.length > 0) {
                myCarDiv.innerHTML = "";
                currentUser.cars.forEach(car => {
                    const p = document.createElement("p");
                    p.textContent = `${car.carNumber} - ${car.carCompany} ${car.carModel} (${car.carSize})`;
                    myCarDiv.appendChild(p);
                });
            } else {
                myCarDiv.textContent = "등록된 차량 없음";
            }
        }

        // 로그아웃
        document.getElementById("logoutBtn").addEventListener("click", () => {
            localStorage.removeItem("currentUser");
            alert("로그아웃 되었습니다.");
            window.location.href = "index.html";
        });

        // 포인트 충전
        function chargePoints() {
            const amount = prompt("충전할 금액을 입력하세요 (예: 10000)");
            if (!amount || isNaN(amount)) return;
            currentUser.points = (currentUser.points || 0) + parseInt(amount);

            let users = JSON.parse(localStorage.getItem("users")) || [];
            users = users.map(u => u.phone === currentUser.phone ? currentUser : u);
            localStorage.setItem("users", JSON.stringify(users));
            localStorage.setItem("currentUser", JSON.stringify(currentUser));

            document.getElementById("userPoints").innerText = currentUser.points.toLocaleString() + "P";
            alert(`${parseInt(amount).toLocaleString()}원이 충전되었습니다!`);
        }
    </script>
</body>

</html>