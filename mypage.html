<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CARPOOOO - ë§ˆì´í˜ì´ì§€</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
</head>

<body>
    <div class="header">
        <h4 class="fw-bold">ë§ˆì´í˜ì´ì§€</h4>
        <p id="welcomeMsg" class="mb-0"></p>
        <button id="logoutBtn" class="btn btn-sm btn-outline-light mt-2">ë¡œê·¸ì•„ì›ƒ</button>
    </div>

    <div class="container mt-4">
        <!-- ë¦¬ì›Œë“œ -->
        <div class="card p-3 mb-3 text-center">
            <h6 class="fw-bold">ë¦¬ì›Œë“œ & ì¶©ì „ê¸ˆ</h6>
            <p class="mb-1">ë³´ìœ  í¬ì¸íŠ¸: <span id="userPoints" class="fw-bold text-primary">0P</span></p>
            <button class="btn btn-sm btn-primary" onclick="chargePoints()">ì¶©ì „í•˜ê¸°</button>
        </div>

        <!-- ë‚´ ì°¨ -->
        <div class="card p-3 mb-3">
            <h6 class="fw-bold"><i class="bi bi-car-front-fill me-1"></i> ë‚´ ì°¨</h6>
            <div id="myCar">ë“±ë¡ëœ ì°¨ëŸ‰ ì—†ìŒ</div>
        </div>

        <!-- ì´ìš©ê¶Œ -->
        <div class="card p-3 mb-3">
            <h6 class="fw-bold"><i class="bi bi-ticket-perforated-fill me-1"></i> ì´ìš©ê¶Œ</h6>
            <p id="myTickets">ë³´ìœ  ì´ìš©ê¶Œ ì—†ìŒ</p>
        </div>

        <!-- ì´ìš© ë‚´ì—­ -->
        <div class="card p-3 mb-3">
            <h6 class="fw-bold"><i class="bi bi-clock-history me-1"></i>ìµœê·¼ì´ìš©ë‚´ì—­</h6>
            <ul id="myHistory" class="list-group list-group-flush">
                <li class="list-group-item">ë‚´ì—­ ì—†ìŒ</li>
            </ul>
        </div>
    </div>

    <div class="footer">
        <p>Â© 2025 CARPOOOO. All rights reserved.</p>
    </div>

    <div class="tabbar">
        <div onclick="location.href='search.html'"><i class="bi bi-search"></i>ê²€ìƒ‰</div>
        <div onclick="location.href='booking.html'"><i class="bi bi-calendar-check"></i>ì˜ˆì•½</div>
        <div onclick="location.href='index.html'"><i class="bi bi-house-door-fill"></i>í™ˆ</div>
        <div onclick="location.href='wishlist.html'"><i class="bi bi-heart-fill"></i>ì°œ</div>
        <div class="active" onclick="location.href='mypage.html'"><i class="bi bi-person-circle"></i>ë§ˆì´</div>
    </div>

    <script>
        const currentUser = JSON.parse(localStorage.getItem("currentUser"));
        if (!currentUser) {
            alert("ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.");
            window.location.href = "login.html";
        } else {
            // í™˜ì˜ ë©”ì‹œì§€ & í¬ì¸íŠ¸ í‘œì‹œ
            document.getElementById("welcomeMsg").innerText = `${currentUser.name}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤ ğŸ‘‹`;
            document.getElementById("userPoints").innerText = (currentUser.points || 0).toLocaleString() + "P";

            // ğŸš— ë‚´ ì°¨ í‘œì‹œ
            const myCarDiv = document.getElementById("myCar");
            if (currentUser.cars && currentUser.cars.length > 0) {
                myCarDiv.innerHTML = "";
                currentUser.cars.forEach(car => {
                    const p = document.createElement("p");
                    p.textContent = `${car.carNumber} - ${car.carCompany} ${car.carModel} (${car.carSize})`;
                    myCarDiv.appendChild(p);
                });
            } else {
                myCarDiv.textContent = "ë“±ë¡ëœ ì°¨ëŸ‰ ì—†ìŒ";
            }
        }

        // ë¡œê·¸ì•„ì›ƒ
        document.getElementById("logoutBtn").addEventListener("click", () => {
            localStorage.removeItem("currentUser");
            alert("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.");
            window.location.href = "index.html";
        });

        // í¬ì¸íŠ¸ ì¶©ì „
        function chargePoints() {
            const amount = prompt("ì¶©ì „í•  ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 10000)");
            if (!amount || isNaN(amount)) return;
            currentUser.points = (currentUser.points || 0) + parseInt(amount);

            let users = JSON.parse(localStorage.getItem("users")) || [];
            users = users.map(u => u.phone === currentUser.phone ? currentUser : u);
            localStorage.setItem("users", JSON.stringify(users));
            localStorage.setItem("currentUser", JSON.stringify(currentUser));

            document.getElementById("userPoints").innerText = currentUser.points.toLocaleString() + "P";
            alert(`${parseInt(amount).toLocaleString()}ì›ì´ ì¶©ì „ë˜ì—ˆìŠµë‹ˆë‹¤!`);
        }
    </script>
</body>

</html>